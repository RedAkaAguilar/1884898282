<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, viewport-fit=cover"/>
<title>Producto</title>

<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;700&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded" rel="stylesheet">

<style>
:root{
  --bg:#0e1116;
  --card:#121826;
  --border:rgba(255,255,255,.08);
  --text:#ffffff;
  --muted:#94a3b8;
  --accent:#38bdf8;
  --cta:#22c55e;
}

* {
  box-sizing:border-box
  max-width: 100vw;
}

*, *::before, *::after {
  -webkit-tap-highlight-color: rgba(0,0,0,0);
  -webkit-focus-ring-color: rgba(0,0,0,0);
  outline: none !important;
}

html, body {
  overflow-x: hidden;
  overflow-y: auto;
  width: 100%;
  touch-action: pan-y;
  overscroll-behavior-x: none;
}

body{
  margin:0;
  font-family:Outfit,sans-serif;
  background:var(--bg);
  color:var(--text);
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

/* ---------- CONTENEDOR ---------- */

.container{
  max-width:1200px;
  margin:auto;
  padding:20px;
}

/* ---------- TARJETA ---------- */

.product{
  display:grid;
  gap:24px;
}

/* PC */
@media(min-width:900px){
  .product{
    grid-template-columns:1.1fr 1fr;
    align-items:start;
  }
}

/* ---------- IMAGEN ---------- */

.media{
  background:rgba(255,255,255,.03);
  border:1px solid var(--border);
  border-radius:18px;
  padding:16px;
}

.media img{
  width:100%;
  height:420px;
  object-fit:contain;
  transition:transform .4s ease;
}

.media:hover img{
  transform:scale(1.05);
}

/* ---------- INFO ---------- */

.info h1{
  font-size:clamp(22px,2.6vw,30px);
  margin:0 0 10px;
}

.rating{
  font-size:16px;
  letter-spacing:2px;
  color:#facc15;
  margin-bottom:10px;
}

.rating span{
  color:#94a3b8;
}

.desc{
  font-size:15px;
  line-height:1.6;
  color:var(--muted);
  margin-top:10px;
}

/* ---------- COMPRA ---------- */

.buy{
  background:linear-gradient(180deg,rgba(255,255,255,.06),rgba(255,255,255,.02));
  border:1px solid var(--border);
  border-radius:18px;
  padding:18px;
  margin-top:16px;
}

.price{
  display:flex;
  align-items:baseline;
  gap:10px;
}

.price .current{
  font-size:30px;
  font-weight:700;
  color:white;
}

.price .old{
  font-size:14px;
  text-decoration:line-through;
  color:var(--muted);
}

.stock{
  font-size:14px;
  color:#4ade80;
  margin:8px 0;
}

/* ---------- BOTONES ---------- */

.actions{
  display:flex;
  gap:12px;
  margin-top:16px;
}

.btn{
  flex:1;
  height:48px;
  display:flex;
  align-items:center;
  justify-content:center;
  text-align:center;
  border:none;
  border-radius:14px;
  font-weight:700;
  cursor:pointer;
  background:linear-gradient(135deg,var(--cta),var(--accent));
  color:white;
}

.btn:hover{
  box-shadow:0 10px 30px rgba(34,197,94,.3);
}

.btn.alt{
  background:transparent;
  border:1px solid var(--border);
}

/* ---------- BACK ---------- */

.back{
  display:inline-flex;
  align-items:center;
  gap:6px;
  font-size:14px;
  color:var(--muted);
  text-decoration:none;
  margin-bottom:12px;
}

.back:hover{
  color:white;
}

.fav{
  width:48px;
  flex:0 0 48px;
  display:flex;
  align-items:center;
  justify-content:center;
}

.fav.active{
  border-color:#ec4899;
}

.fav.active span{
  color:#ec4899;
}

/* ---------- MOBILE ---------- */

@media(max-width:899px){
  .media img{
    height:300px;
  }
}
</style>
</head>

<body>

<div class="container">
  <a href="shop.html" class="back">
    <span class="material-symbols-rounded">arrow_back</span>
    Volver a la tienda
  </a>

  <div id="product"></div>
</div>
<script src="https://www.paypal.com/sdk/js?client-id=AXX-gsl8idRGstMRyweLZTOkRPBTqF8Yoy2ZNwLhIGwsfX8ptU7E7wtFEYZmh5VixYO1Y7Cq1SS9LaXi&currency=USD"></script>

<script>
const params = new URLSearchParams(location.search);
const id = params.get("id");

async function cargar(){
  const res = await fetch("../api/control/tienda.json");
  const data = await res.json();
  const p = data.productos.find(x => x.id === id);

  if(!p){
    product.innerHTML = "Producto no encontrado";
    return;
  }

  const final = p.descuento
    ? (p.precio - p.precio * p.descuento / 100).toFixed(2)
    : p.precio;

  product.innerHTML = `
    <div class="product">
      <div class="media">
        <img src="${p.imagen}" alt="${p.titulo}">
      </div>

      <div class="info">
        <h1>${p.titulo}</h1>

        <div class="rating">
        ★★★★★
        </div>

        <p class="desc">${p.descripcion}</p>

        <div class="buy">
          <div class="price">
            <div class="current">$${final}</div>
            ${p.descuento ? `<div class="old">${p.precio}</div>` : ""}
          </div>

          <div class="stock">Disponible</div>

          <div class="actions">
            <div id="paypal-button-container"></div>
           
           <button class="btn alt fav" data-id="${p.id}">
          <span class="material-symbols-rounded">favorite</span>
          </button>
        </div>
      </div>
    </div>
  `;
paypal.Buttons({
  createOrder: function(data, actions) {
    return actions.order.create({
      purchase_units: [{
        amount: {
          value: p.precio
        },
        description: p.titulo // descripción del producto
      }]
    });
  },
  onApprove: function(data, actions) {
    return actions.order.capture().then(function(details) {
      alert('Pago completado por ' + details.payer.name.given_name);
      // Aquí puedes hacer más acciones, como redirigir o actualizar UI
    });
  },
  onError: function(err) {
    console.error(err);
    alert('Error en el pago, intenta nuevamente.');
  }
}).render('#paypal-button-container');
}

cargar();
initFavorito(p.id);
function initFavorito(productId){
  const favBtn = document.querySelector('.fav');
  if(!favBtn) return;

  const key = 'fav_' + productId;

  // estado guardado
  if(localStorage.getItem(key) === 'true'){
    favBtn.classList.add('active');
  }

  favBtn.addEventListener('click', () => {
    favBtn.classList.toggle('active');
    localStorage.setItem(key, favBtn.classList.contains('active'));
  });
}

  document.addEventListener('contextmenu', e => {
  if (e.target.tagName === 'IMG') {
    e.preventDefault();
  }
});

document.addEventListener('touchstart', function (e) {
  if (e.touches.length > 1) {
    e.preventDefault();
  }
}, { passive: false });

let lastTouchEnd = 0;
document.addEventListener('touchend', function (e) {
  const now = Date.now();
  if (now - lastTouchEnd <= 300) {
    e.preventDefault();
  }
  lastTouchEnd = now;
}, false);

  document.addEventListener('wheel', function (e) {
  if (e.ctrlKey) {
    e.preventDefault();
  }
}, { passive: false });

</script>

</body>
</html>
