<!doctype html>

<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>Apps</title>

<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>
:root{
  --bg:#0e1116;
  --card:rgba(255,255,255,.12);
  --border:rgba(255,255,255,.18);
  --text:#fff;
  --muted:#9ca3af;
  --radius:26px;
}

*{box-sizing:border-box}

body{
  margin:0;
  font-family:Outfit,system-ui;
  background:var(--bg);
  color:var(--text);
  overflow-x:hidden;
}

/* ===== HEADER ===== */
header{
  position:sticky;
  top:0;
  z-index:10;
  padding:22px 20px 14px;
  backdrop-filter:blur(22px);
  background:linear-gradient(
    to bottom,
    rgba(14,17,22,.85),
    rgba(14,17,22,.35),
    transparent
  );
}

header h1{
  margin:0;
  font-size:26px;
  font-weight:700;
}

/* ===== CATEGORY ===== */
.section{
  padding:18px 0 26px;
}

.section-title{
  padding:0 20px 12px;
  font-size:18px;
  font-weight:600;
}

/* ===== APP ROW ===== */
.row{
  display:flex;
  gap:16px;
  padding:0 20px;
  overflow-x:auto;
  scroll-snap-type:x mandatory;
}

.row::-webkit-scrollbar{display:none}

.app-card{
  flex:0 0 160px;
  scroll-snap-align:start;
  background:var(--card);
  border:1px solid var(--border);
  border-radius:var(--radius);
  overflow:hidden;
  cursor:pointer;
  transition:transform .35s ease, box-shadow .35s ease;
}

.app-card:hover{
  transform:translateY(-6px) scale(1.03);
  box-shadow:0 40px 90px rgba(0,0,0,.6);
}

.app-thumb{
  height:110px;
  background-size:cover;
  background-position:center;
}

.app-info{
  padding:14px;
}

.app-info h3{
  margin:0;
  font-size:15px;
  font-weight:600;
}

.app-info span{
  font-size:12px;
  color:var(--muted);
}

/* ===== GRID VIEW (AUTHOR CLICK) ===== */
#authorView{
  position:fixed;
  inset:0;
  background:var(--bg);
  z-index:100;
  display:none;
  flex-direction:column;
}

.author-header{
  padding:22px 20px;
  display:flex;
  align-items:center;
  gap:14px;
}

.back{
  font-size:14px;
  color:var(--muted);
  cursor:pointer;
}

.author-header h2{
  margin:0;
  font-size:22px;
}

.grid{
  padding:18px;
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(150px,1fr));
  gap:18px;
}

.grid .app-card{
  flex:none;
}
</style>

</head>

<body>

<header>
  <h1>Aplicaciones</h1>
</header>

<main id="content"></main>

<!-- AUTHOR FULL VIEW -->

<div id="authorView">
  <div class="author-header">
    <div class="back" onclick="closeAuthor()">‚Üê Volver</div>
    <h2 id="authorTitle"></h2>
  </div>
  <div class="grid" id="authorGrid"></div>
</div>

<script>
const JSON_URL = "/api/control/descarga-manager.json"
const content = document.getElementById("content")

fetch(JSON_URL + "?ts=" + Date.now())
.then(r=>r.json())
.then(data=>{
  const groups = {}

  data.apps.forEach(app=>{
    if(!groups[app.author]) groups[app.author] = []
    groups[app.author].push(app)
  })

  Object.entries(groups).forEach(([author,apps])=>{
    const section = document.createElement("section")
    section.className = "section"

    section.innerHTML = `
      <div class="section-title">${author}</div>
      <div class="row"></div>
    `

    const row = section.querySelector(".row")

    apps.forEach(app=>{
      const card = document.createElement("div")
      card.className = "app-card"
      card.innerHTML = `
        <div class="app-thumb" style="background-image:url('${app.background}')"></div>
        <div class="app-info">
          <h3>${app.title}</h3>
          <span>${app.author}</span>
        </div>
      `

      card.onclick = ()=>openAuthor(author, apps)
      row.appendChild(card)
    })

    content.appendChild(section)
  })
})

function openAuthor(author, apps){
  document.getElementById("authorTitle").textContent = author
  const grid = document.getElementById("authorGrid")
  grid.innerHTML = ""

  apps.forEach(app=>{
    const card = document.createElement("div")
    card.className = "app-card"
    card.innerHTML = `
      <div class="app-thumb" style="background-image:url('${app.background}')"></div>
      <div class="app-info">
        <h3>${app.title}</h3>
      </div>
    `
    card.onclick = ()=>location.href = "download.html?id=" + app.id
    grid.appendChild(card)
  })

  document.getElementById("authorView").style.display = "flex"
}

function closeAuthor(){
  document.getElementById("authorView").style.display = "none"
}
</script>

</body>
</html>

