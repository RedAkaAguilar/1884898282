<!doctype html>

<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>App Store</title>

<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded" rel="stylesheet">

<style>
:root{
  --bg:#0b0f17;
  --glass:rgba(255,255,255,.08);
  --border:rgba(255,255,255,.15);
  --text:#fff;
  --muted:#9ca3af;
  --radius:26px;
}

*{box-sizing:border-box}

body{
  margin:0;
  font-family:Outfit,system-ui;
  background:var(--bg);
  color:var(--text);
  overflow-x:hidden;
}

/* ===== CINEMATIC BG ===== */
.cinematic-bg{
  position:fixed;
  inset:-20%;
  z-index:-1;
  background:
    radial-gradient(1200px 800px at 10% 10%, rgba(99,102,241,.25), transparent 60%),
    radial-gradient(1200px 800px at 90% 80%, rgba(236,72,153,.22), transparent 60%);
  filter:blur(120px);
  animation:bgMove 40s ease-in-out infinite;
}

@keyframes bgMove{
  50%{transform:translate(-120px,-80px)}
}

/* ===== HEADER ===== */
header{
  position:sticky;
  top:0;
  z-index:20;
  padding:22px;
  backdrop-filter:blur(28px) saturate(180%);
  background:linear-gradient(
    to bottom,
    rgba(11,15,23,.9),
    rgba(11,15,23,.6),
    transparent
  );
}

header h1{
  margin:0 0 14px;
  font-size:28px;
}

/* ===== SEARCH ===== */
.search{
  position:relative;
}

.search input{
  width:100%;
  padding:16px 18px;
  border-radius:18px;
  border:1px solid var(--border);
  background:var(--glass);
  color:#fff;
  font-size:15px;
  outline:none;
}

/* ===== SECTION ===== */
.section{
  padding:26px 0;
  opacity:0;
  transform:translateY(50px);
  animation:sectionIn .9s cubic-bezier(.22,1,.36,1) forwards;
}

.section:nth-child(2){animation-delay:.15s}
.section:nth-child(3){animation-delay:.3s}

@keyframes sectionIn{
  to{opacity:1;transform:none}
}

.section h2{
  padding:0 22px 14px;
  font-size:20px;
}

/* ===== ROW ===== */
.row{
  display:flex;
  gap:18px;
  padding:0 22px;
  overflow-x:auto;
  scroll-snap-type:x mandatory;
}

.row::-webkit-scrollbar{display:none}

/* ===== CARD ===== */
.card{
  flex:0 0 170px;
  border-radius:28px;
  background:var(--glass);
  border:1px solid var(--border);
  overflow:hidden;
  cursor:pointer;
  transform-style:preserve-3d;
  transition:.5s cubic-bezier(.22,1,.36,1);
}

.card:hover{
  transform:translateY(-14px) scale(1.08);
  box-shadow:0 60px 140px rgba(0,0,0,.8);
  z-index:5;
}

.card:active{transform:scale(.96)}

.thumb{
  height:115px;
  background-size:cover;
  background-position:center;
}

.info{
  padding:14px;
}

.info h3{
  margin:0;
  font-size:15px;
}

.info span{
  font-size:12px;
  color:var(--muted);
}

/* ===== GRID ===== */
.grid{
  padding:0 22px;
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(160px,1fr));
  gap:18px;
}
</style>

</head>

<body>

<div class="cinematic-bg"></div>

<header>
  <h1>Aplicaciones</h1>
  <div class="search">
    <input id="search" placeholder="Buscar apps o autores...">
  </div>
</header>

<main id="content"></main>

<script>
const JSON_URL = "/api/control/descarga-manager.json"
const content = document.getElementById("content")
const search = document.getElementById("search")

let allApps = []

fetch(JSON_URL + "?ts=" + Date.now())
.then(r=>r.json())
.then(data=>{
  allApps = data.apps
  render(allApps)
})

function render(apps){
  content.innerHTML = ""

  const authors = {}
  apps.forEach(a=>{
    if(!authors[a.author]) authors[a.author] = []
    authors[a.author].push(a)
  })

  /* AUTHORS */
  const authorSection = document.createElement("section")
  authorSection.className = "section"
  authorSection.innerHTML = `<h2>Autores</h2>`

  Object.entries(authors).forEach(([author,list])=>{
    const row = document.createElement("div")
    row.className = "row"

    list.forEach(app=>{
      row.innerHTML += `
        <div class="card" onclick="location.href='download.html?id=${app.id}'">
          <div class="thumb" style="background-image:url('${app.background}')"></div>
          <div class="info">
            <h3>${app.title}</h3>
            <span>${author}</span>
          </div>
        </div>
      `
    })

    authorSection.innerHTML += `<h2 style="font-size:16px">${author}</h2>`
    authorSection.appendChild(row)
  })

  content.appendChild(authorSection)

  /* ALL APPS */
  const appSection = document.createElement("section")
  appSection.className = "section"
  appSection.innerHTML = `<h2>Todas las Apps</h2><div class="grid"></div>`

  const grid = appSection.querySelector(".grid")

  apps.forEach(app=>{
    grid.innerHTML += `
      <div class="card" onclick="location.href='download.html?id=${app.id}'">
        <div class="thumb" style="background-image:url('${app.background}')"></div>
        <div class="info">
          <h3>${app.title}</h3>
          <span>${app.author}</span>
        </div>
      </div>
    `
  })

  content.appendChild(appSection)
}

search.oninput = ()=>{
  const q = search.value.toLowerCase()
  const filtered = allApps.filter(a=>
    a.title.toLowerCase().includes(q) ||
    a.author.toLowerCase().includes(q)
  )
  render(filtered)
}
</script>

</body>
</html>
