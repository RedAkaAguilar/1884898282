<!doctype html>

<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>App Store</title>

<link rel="icon" type="image/png" href="/ico/favicon-96x96.png" sizes="96x96" />
<link rel="icon" type="image/svg+xml" href="/ico/favicon.svg" />
<link rel="shortcut icon" href="/ico/favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="/ico/apple-touch-icon.png" />
<meta name="apple-mobile-web-app-title" content="ZyrNet" />
<link rel="manifest" href="/ico/site.webmanifest" />
  
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded" rel="stylesheet">

<style>
:root{
  --bg:#0b0f17;
  --glass:rgba(255,255,255,.08);
  --border:rgba(255,255,255,.15);
  --text:#fff;
  --muted:#9ca3af;
  --radius:26px;
}

*{box-sizing:border-box}

body{
  margin:0;
  font-family:Outfit,system-ui;
  background:var(--bg);
  color:var(--text);
  overflow-x:hidden;
}

.cinematic-bg{
  position:fixed;
  inset:-20%;
  z-index:-1;
  background:
    radial-gradient(1200px 800px at 10% 10%, rgba(99,102,241,.25), transparent 60%),
    radial-gradient(1200px 800px at 90% 80%, rgba(236,72,153,.22), transparent 60%);
  filter:blur(120px);
  animation:bgMove 40s ease-in-out infinite;
}

@keyframes bgMove{
  50%{transform:translate(-120px,-80px)}
}

header{
  position:sticky;
  top:0;
  z-index:20;
  padding:22px;
  backdrop-filter:blur(28px) saturate(180%);
  background:linear-gradient(
    to bottom,
    rgba(11,15,23,.9),
    rgba(11,15,23,.6),
    transparent
  );
}

header h1{
  margin:0 0 14px;
  font-size:28px;
}

.search{
  position:relative;
}

.search input{
  width:100%;
  padding:16px 18px;
  border-radius:18px;
  border:1px solid var(--border);
  background:var(--glass);
  color:#fff;
  font-size:15px;
  outline:none;
}

.section{
  padding:26px 0;
  opacity:0;
  transform:translateY(50px);
  animation:sectionIn .9s cubic-bezier(.22,1,.36,1) forwards;
}

.section:nth-child(2){animation-delay:.15s}
.section:nth-child(3){animation-delay:.3s}

@keyframes sectionIn{
  to{opacity:1;transform:none}
}

.section h2{
  padding:0 22px 14px;
  font-size:20px;
}

.row{
  display:flex;
  gap:18px;
  padding:0 22px;
  overflow-x:auto;
  scroll-snap-type:x mandatory;
}

.row::-webkit-scrollbar{display:none}

.card{
  position:relative;
  flex:0 0 180px;
  aspect-ratio:9/16;
  border-radius:28px;
  background:#000;
  overflow:hidden;
  cursor:pointer;
  transform-style:preserve-3d;
  transition:
    aspect-ratio .6s cubic-bezier(.22,1,.36,1),
    transform .6s cubic-bezier(.22,1,.36,1),
    box-shadow .6s ease;
}

.card.active{
  aspect-ratio:16/9;
  transform:scale(1.08);
  box-shadow:0 60px 160px rgba(0,0,0,.9);
  z-index:20;
}

.card-bg{
  position:absolute;
  inset:0;
  background-size:cover;
  background-position:center;
  filter:brightness(.9);
  transition:filter .6s ease, transform .6s ease;
}

.card.active .card-bg{
  filter:brightness(.6) blur(2px);
  transform:scale(1.1);
}

.card-logo{
  position:absolute;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  opacity:0;
  transform:translateY(40px) scale(.9);
  transition:.6s cubic-bezier(.22,1,.36,1);
}

.card-logo img{
  max-width:60%;
  max-height:40%;
  filter:drop-shadow(0 30px 80px rgba(0,0,0,.9));
}

.card.active .card-logo{
  opacity:1;
  transform:none;
}

.thumb{
  height:115px;
  background-size:cover;
  background-position:center;
}

.info{
  padding:14px;
}

.info h3{
  margin:0;
  font-size:15px;
}

.info span{
  font-size:12px;
  color:var(--muted);
}

.search-results{
  padding:22px;
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(160px,1fr));
  gap:20px;
}

.author-result{
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:10px;
  cursor:pointer;
}

.author-circle{
  width:96px;
  height:96px;
  border-radius:50%;
  background-size:cover;
  background-position:center;
  box-shadow:0 20px 60px rgba(0,0,0,.6);
}

.author-result span{
  font-size:13px;
  color:var(--muted);
}

.grid{
  padding:0 22px;
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(160px,1fr));
  gap:18px;
}
</style>

</head>

<body>

<div class="cinematic-bg"></div>

<header>
  <h1>Aplicaciones</h1>
  <div class="search">
    <input id="search" placeholder="Buscar apps o autores...">
    <div id="results"></div>
  </div>
</header>

<main id="content"></main>

<script>
const JSON_URL = "/api/control/descarga-manager.json"
const content = document.getElementById("content")
const search = document.getElementById("search")

let allApps = []

fetch(JSON_URL + "?ts=" + Date.now())
.then(r=>r.json())
.then(data=>{
  allApps = data.apps
  render(allApps)
})

function render(apps){
  content.innerHTML = ""

  const authors = {}
  apps.forEach(a=>{
    if(!authors[a.author]) authors[a.author] = []
    authors[a.author].push(a)
  })

  /* AUTHORS */
  const authorSection = document.createElement("section")
  authorSection.className = "section"
  authorSection.innerHTML = `<h2>Autores</h2>`

  Object.entries(authors).forEach(([author,list])=>{
    const row = document.createElement("div")
    row.className = "row"

    list.forEach(app=>{
      row.innerHTML += `
        <div class="card" onclick="location.href='download.html?id=${app.id}'">
          <div class="thumb" style="background-image:url('${app.background}')"></div>
          <div class="info">
            <h3>${app.title}</h3>
            <span>${author}</span>
          </div>
        </div>
      `
    })

    authorSection.innerHTML += `<h2 style="font-size:16px">${author}</h2>`
    authorSection.appendChild(row)
  })

  content.appendChild(authorSection)

  /* ALL APPS */
  const appSection = document.createElement("section")
  appSection.className = "section"
  appSection.innerHTML = `<h2>Todas las Apps</h2><div class="grid"></div>`

  const grid = appSection.querySelector(".grid")

  apps.forEach(app=>{
    grid.innerHTML += `
      <div class="card" onclick="location.href='download.html?id=${app.id}'">
        <div class="thumb" style="background-image:url('${app.background}')"></div>
        <div class="info">
          <h3>${app.title}</h3>
          <span>${app.author}</span>
        </div>
      </div>
    `
  })

  content.appendChild(appSection)
}

search.oninput = ()=>{
  const q = search.value.trim().toLowerCase()
  content.innerHTML = ""

  if(!q){
    render(allApps)
    return
  }

  const apps = allApps.filter(a =>
    a.title.toLowerCase().includes(q)
  )

  const authors = [...new Set(
    allApps
      .filter(a => a.author.toLowerCase().includes(q))
      .map(a => a.author)
  )]

  if(apps.length === 0 && authors.length === 0){
    content.innerHTML = `
      <section class="section">
        <h2>No se encontraron resultados</h2>
        <p style="padding:0 22px;color:var(--muted)">
          Intenta con otro nombre o autor
        </p>
      </section>
    `
    return
  }

  const results = document.getElementById("results")
  results.innerHTML += `
  <div class="card" data-id="minecraft">
  <div class="card-bg" style="background-image:url('BG')"></div>
  <div class="card-logo">
    <img src="LOGO">
  </div>
</div>

<div class="author-result">
  <div class="author-circle" style="background-image:url('ICON')"></div>
  <span>Mojang</span>
</div>
`

  const results = document.createElement("div")
  results.className = "search-results"

  authors.forEach(author=>{
    const app = allApps.find(a=>a.author===author)
    results.innerHTML += `
      <div class="author-result" onclick="openAuthor('${author}', allApps.filter(a=>a.author==='${author}'))">
        <div class="author-circle" style="background-image:url('${app.authorIcon}')"></div>
        <span>${author}</span>
      </div>
    `
  })

  apps.forEach(app=>{
    results.innerHTML += `
      <div class="card" onclick="location.href='download.html?id=${app.id}'">
        <div class="card-bg" style="background-image:url('${app.background}')"></div>
        <div class="card-logo">
          <img src="${app.logo}">
        </div>
      </div>
    `
  })

  content.appendChild(results)
}

document.addEventListener("click",e=>{
  const card = e.target.closest(".card")
  if(!card) return

  card.classList.toggle("active")
})
</script>

</body>
</html>
