<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Descarga</title>

<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700;900&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded" rel="stylesheet">

<style>
:root{
--bg:#0e1116;
--txt:#fff;
--muted:#cbd5e1;
--accent:#38bdf8;
--glass:rgba(255,255,255,.08);
--border:rgba(255,255,255,.18);
--radius:18px;
--spring:cubic-bezier(.28,1.25,.55,1);
}

*{box-sizing:border-box}
body{
margin:0;
font-family:Outfit,system-ui;
background:var(--bg);
color:var(--txt);
}

.steam-hero{
position:relative;
height:85vh;
background:linear-gradient(#111,#000);
overflow:hidden;
}

.steam-hero::before{
content:"";
position:absolute;
inset:0;
background:linear-gradient(to bottom,rgba(0,0,0,.3),#0e1116 92%);
}

.steam-hero-bg{
position:absolute;
inset:0;
background-size:cover;
background-position:center;
filter:blur(2px) brightness(.7);
}

.steam-hero-content{
position:absolute;
bottom:80px;
left:50%;
transform:translateX(-50%);
display:flex;
gap:36px;
align-items:flex-end;
width:100%;
max-width:1100px;
padding:0 32px;
}

.steam-capsule{
width:260px;
border-radius:10px;
box-shadow:0 40px 120px rgba(0,0,0,.8);
transition:.6s var(--spring);
}

.steam-meta h1{
margin:0 0 14px;
font-size:44px;
font-weight:900;
}

.steam-meta p{
max-width:520px;
line-height:1.8;
color:var(--muted);
}

.sticky .steam-capsule{
position:fixed;
top:96px;
left:28px;
width:120px;
z-index:999;
}

.app{
max-width:1100px;
margin:auto;
padding:80px 32px 120px;
}

.section{
background:var(--glass);
border:1px solid var(--border);
border-radius:var(--radius);
margin-bottom:22px;
overflow:hidden;
}

.section-header{
display:flex;
align-items:center;
gap:16px;
padding:22px;
cursor:pointer;
}

.section-header span{
font-size:28px;
color:var(--accent);
}

.section-header strong{
flex:1;
font-size:18px;
}

.section-content{
max-height:0;
overflow:hidden;
padding:0 22px;
transition:max-height .6s var(--spring);
}

.section.open .section-content{
max-height:600px;
padding-bottom:22px;
}

.section-content p{
line-height:1.7;
color:var(--muted);
}

.download{
display:inline-flex;
align-items:center;
gap:12px;
padding:14px 22px;
border-radius:999px;
background:linear-gradient(135deg,#22c55e,#38bdf8);
color:white;
font-weight:800;
text-decoration:none;
margin-top:16px;
}

.error{
min-height:100vh;
display:flex;
flex-direction:column;
align-items:center;
justify-content:center;
text-align:center;
gap:14px;
}
</style>
</head>

<body>

<div id="root"></div>

<script>
const DATA_URL = '/api/control/descarga-manager.json'
const root = document.getElementById('root')
const id = new URLSearchParams(location.search).get('id')

const rich = t => t
  .replace(/\n/g,'<br>')
  .replace(/\*\*(.*?)\*\*/g,'<b>$1</b>')
  .replace(/_(.*?)_/g,'<i>$1</i>')
  .replace(/`(.*?)`/g,'<code>$1</code>')

function showError(title,msg){
  root.innerHTML = `
    <div class="error">
      <span class="material-symbols-rounded">error</span>
      <h1>${title}</h1>
      <p>${msg}</p>
    </div>
  `
}

if(!id){
  showError('ID inválido','No se especificó producto.')
}else{
  fetch(DATA_URL + '?v=' + Date.now())
    .then(r=>r.ok?r.json():Promise.reject())
    .then(data=>{
      const p = data.productos?.[id]
      if(!p) throw 'Producto no encontrado'
      render(p)
    })
    .catch(()=>{
      showError('Error','No se pudo cargar la información.')
    })
}

function render(p){
  const heroBg = p.hero?.background || ''
  const capsule = p.hero?.capsule || ''

  root.innerHTML = `
    <section class="steam-hero">
      ${heroBg ? `<div class="steam-hero-bg" style="background-image:url('${heroBg}')"></div>` : ''}
      <div class="steam-hero-content">
        ${capsule ? `<img class="steam-capsule" src="${capsule}">` : ''}
        <div class="steam-meta">
          <h1>${p.titulo}</h1>
          <p>${rich(p.descripcion || '')}</p>
        </div>
      </div>
    </section>

    <main class="app">
      ${(p.secciones || []).map((s,i)=>`
        <div class="section" id="sec${i}">
          <div class="section-header" onclick="toggle(${i})">
            <span class="material-symbols-rounded">${s.icono || 'download'}</span>
            <strong>${s.titulo}</strong>
          </div>
          <div class="section-content">
            <p>${rich(s.descripcion || '')}</p>
            <a class="download" href="${s.url}" target="_blank">
              <span class="material-symbols-rounded">download</span> Descargar
            </a>
          </div>
        </div>
      `).join('')}
    </main>
  `

  setupScroll()
}

function toggle(i){
  document.querySelectorAll('.section').forEach(s=>s.classList.remove('open'))
  document.getElementById('sec'+i)?.classList.add('open')
}

function setupScroll(){
  const hero = document.querySelector('.steam-hero')
  window.addEventListener('scroll',()=>{
    hero.classList.toggle('sticky',window.scrollY > window.innerHeight * .6)
  })
}
</script>

</body>
</html>

